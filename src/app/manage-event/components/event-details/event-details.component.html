<section class="banner">
  <div class="content">
    <h1>{{ eventDetails?.post_title | titlecase }}</h1>
    <p>{{ eventDetails?.country }}</p>
    <div class="listing-rating">
      <div class="d-flex">
        <i class="fa fa-star" aria-hidden="true"></i>
        <i class="fa fa-star" aria-hidden="true"></i>
        <i class="fa fa-star" aria-hidden="true"></i>
        <i class="fa fa-star" aria-hidden="true"></i>
        <i class="fa fa-star" aria-hidden="true"></i>
      </div>
    </div>
  </div>
</section>

<div class="container">
  @if(isGlobal == false){
  <div class="breadcrumb mt-4">
    <div class="breadcrumb">
      <span class="manage-business" (click)="goToEvent()">Events</span>
      <span class="business-details"> > </span>
      <span class="business-details"> Event Details</span>
    </div>
  </div>
  }
  <div class="row mt-4">
    <div class="col-12 col-md-12 col-lg-8">

      <div class="row mt-3">
        <h3 class="event-page-heading">Event Details</h3>
        <table class="table table-responsive table-borderless">
          <tbody>
            <tr>
              <td class="table-title">Description</td>
              <td class="table-subtitle">{{ eventDetails?.post_content }}</td>
            </tr>
            <tr>
              <td class="table-title">Start Date</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle"> {{ eventDetails?.event_dates.start_date | date:
                'dd/MM/yyyy' }}</td>
            </tr>
            <tr>
              <td class="table-title">End Date</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle"> {{ eventDetails?.event_dates.end_date | date:
                'dd/MM/yyyy' }}</td>
            </tr>
            <tr>
              <td class="table-title">Start Time</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle">{{ eventDetails?.event_dates.start_time || 'NA' }}</td>
            </tr>
            <tr>
              <td class="table-title">End Time</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle">{{ eventDetails?.event_dates.end_time || 'NA'}}</td>
            </tr>
            <tr>
              <td class="table-title">Category</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle">{{ eventDetails?.post_category?.name }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="row mt-4">
        <h3 class="event-page-heading">Address</h3>
        <table class="table table-responsive table-borderless">
          <tbody>
            <tr>
              <td class="table-title">Street</td>
              <td class="table-subtitle">{{ eventDetails?.street }}</td>
            </tr>
            <tr>
              <td class="table-title">Region</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle">{{ eventDetails?.region || 'NA' }}</td>
            </tr>
            <tr>
              <td class="table-title">Country</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle">{{ eventDetails?.country || 'NA' }}</td>
            </tr>
            <tr>
              <td class="table-title">City</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle">{{ eventDetails?.city || 'NA' }}</td>
            </tr>
            <tr>
              <td class="table-title">Zip</td>
              <td _ngcontent-tkn-c107="" class="table-subtitle">{{ eventDetails?.zip || 'NA'}}</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
    <div class="col-12 col-md-12 col-lg-4 mt-3">
      <div class="profile-info-div">
        <h3>Contact Info</h3>
        {{ eventDetails?.user_detail?.contact_info }}
      </div>
      <div class="profile-info-div mt-3">
        <h3>Author</h3>
        {{ eventDetails?.user_detail?.display_name }}
      </div>
    </div>
  </div>
  <div class="row  my-4">
    <div class="col-12">
      <h3 class="event-page-heading">Photo(s)</h3>

      <div class="featured_image">
        <img [src]="
            eventDetails?.featured_image
              ? eventDetails?.featured_image
              : '/assets/image/carrer-proffesional.jpeg'
          " />
      </div>
    </div>
  </div>
  <div class="row  my-4">
    <div class="col-12">
      <h3 class="event-page-heading">Map</h3>
    </div>
    <div class="col-12 col-lg-6">
      <div id="map" style="height: 300px; width: 100%"></div>
    </div>
  </div>

  <!-- @if(isGlobal == 'true'){ -->
  <form [formGroup]="reviewForm">

    <div class="row mt-5">

      <div class="col-12 col-lg-6">
        @for(key of reviewsArray; track key.comment_id; let index = $index){
        <div class="card mt-3 shadow-sm">
          <div class="bsui toast-header">
            <div class="profile__">
              <img
                src="https://vietlist.biz/staging_dev/wp-content/uploads/2024/01/1_ITy1iE0UHDJlhJU3XZBkf2TlIajHPpz@20070588@3-1-1_uwp_avatar_thumb.jpg" />
            </div>
            <span>
              {{key.comment_author_email}}
            </span>
            <div class="rating__">
              <div class="d-flex">
                @if(key?.rating >= 1) {<i class="fa fa-star" aria-hidden="true"
                  style="color:rgb(255, 213, 62);font-size:17px"></i>}
                @if(key?.rating >= 2) {<i class="fa fa-star" aria-hidden="true"
                  style="color:rgb(255, 213, 62);font-size:17px"></i>}
                @if(key?.rating >= 3) {<i class="fa fa-star" aria-hidden="true"
                  style="color:rgb(255, 213, 62);font-size:17px"></i>}
                @if(key?.rating >= 4) {<i class="fa fa-star" aria-hidden="true"
                  style="color:rgb(255, 213, 62);font-size:17px"></i>}
                @if(key?.rating > 4) {<i class="fa fa-star" aria-hidden="true"
                  style="color:rgb(255, 213, 62);font-size:17px"></i>}
              </div>
            </div>
          </div>
          <div class="comment-content comment card-body my-5">
            <div class="description">
              <p>{{key.comment_content}}</p>
              @for(replies of repliesArray ; track $index){
              <p class="ml-1">{{replies.comment_content}}</p>
              }
              <p style="cursor:pointer" (click)="showReplyField(index)" *ngIf="isAuthentecate"> <i class="fa fa-reply" aria-hidden="true"></i>
                Reply </p>
            </div>

            @if(isReplyFieldOpen && replyIndex === index){
            <div class="d-flex">
      
              <div class="flex-grow-1"><input type="text" class="input-control" [formControl]="replyInput" /></div>
              <div class="mx-1"><button class="btn reply-btn" (click)="handlereply(key.comment_id)">Reply</button></div>
          
            </div>
          
            }
            @else{
              @if(isAuthentecate){
            <div class="d-none"> <!-- Hide the reply input by default -->
              <div class="flex-grow-1"><input type="text" class="input-control" /></div>
              <div class="mx-1"><button class="btn reply-btn">Reply</button></div>
            </div>
            }
            }

          </div>
        </div>
        }
      </div>



      @if(isGlobal == 'true'){
      <div class="col-12 mt-4">
        <h3 class="event-page-heading">Leave Review</h3>
      </div>
      <div class="col-12 col-md-12 col-lg-6">
        <div class="alert alert-warning" role="alert">
          Your email address will not be published.
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-md-12 col-lg-6">
          <ngx-star-rating formControlName="rating" [id]="'rating'" style="float: left;"></ngx-star-rating>
        </div>
      </div>
      @if(isAuthentecate){
      <div class="row my-2">
        <div class="col-12 col-md-12 col-lg-6">
          <input type="text" formControlName="comment_author" class="input-control" placeholder="Enter your name" />
        </div>
      </div>
      <div class="row my-2">
        <div class="col-12 col-md-12 col-lg-6">
          <input type="text" formControlName="comment_author_email" class="input-control"
            placeholder="Enter your email" />
        </div>
        @if (
        reviewForm.get('comment_author_email')?.touched &&
        reviewForm.get('comment_author_email')?.hasError('required')
        ) {
        <span class="error-message">Email is required</span>
        }
        @if (reviewForm.get('comment_author_email')?.hasError('pattern')) {
        <span class="error-message">Enter valid email</span>
        }
      </div>
      <div class="row my-2">
        <div class="col-12 col-md-12 col-lg-6">
          <input type="text" formControlName="comment_author_url" class="input-control"
            placeholder="Enter your website" />
        </div>
      </div>
      <div class="row my-2">
        <div class="col-12 col-md-12 col-lg-6">
          <div class="form-group">
            <div class="form-check">
              <input class="form-check-input" [(ngModel)]="slectedvalue" [ngModelOptions]="{standalone: true}"
                (change)="selcetdvalues()" type="checkbox" value="" id="terms" />
              <label class="form-check-label" for="terms">
                Save my name, email, and website in this browser for the next time
                I comment.
              </label>
            </div>
          </div>
        </div>
      </div>

      }
      <div class="row my-2">
        <div class="col-12 col-md-12 col-lg-6">
          <textarea formControlName="comment_content" name="" id="" cols="30" rows="10" class="textarea"
            placeholder="Enter your comments"></textarea>
        </div>
      </div>
      <div class="row mt-2 mb-4">
        <div class="col-12 col-md-12 col-lg-6">
          <button class="btn orange-background-btn-w-100" [disabled]="!reviewForm.valid" (click)="submit()">
            @if(isLoader){
            <app-loader></app-loader>
            }@else {
            Post Review
            }
          </button>
        </div>
      </div>
      }
    </div>

  </form>
  <!-- } -->
</div>